<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - SmartMall</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="SmartMall" class="navbar-logo">
                <h1>üõçÔ∏è SmartMall</h1>
            </div>
            <div class="navbar-menu">
                <a href="/" class="nav-link">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                <a href="/cart" class="nav-link active">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <section class="cart-section">
            <h2>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

            {% if cart_items %}
                <div class="cart-grid">
                    <div class="cart-items">
                        {% for item in cart_items %}
                            <div class="cart-item">
                                <img src="{{ url_for('static', filename='images/products/product_' + item.id|string + '.png') }}" 
                                     alt="{{ item.name }}">
                                <div class="item-details">
                                    <h3>{{ item.name }}</h3>
                                    <p>‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ø{{ "{:,}".format(item.price) }}</p>
                                </div>
                                <div class="item-quantity">
                                    <button onclick="decreaseQty({{ item.id }})">‚àí</button>
                                    <input type="number" id="qty-{{ item.id }}" value="{{ item.quantity }}" min="1" 
                                           onchange="updateQty({{ item.id }}, this.value)">
                                    <button onclick="increaseQty({{ item.id }})">+</button>
                                </div>
                                <div class="item-total">
                                    ‡∏ø{{ "{:,}".format(item.total) }}
                                </div>
                                <button class="btn btn-remove" onclick="removeFromCart({{ item.id }})">
                                    ‡∏•‡∏ö
                                </button>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="cart-summary">
                        <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
                        <div class="summary-row">
                            <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</span>
                            <span>‡∏ø{{ "{:,}".format(subtotal) }}</span>
                        </div>
                        <div class="summary-row">
                            <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</span>
                            <span>‡∏ø{{ "{:,}".format(shipping) }}</span>
                        </div>
                        <div class="summary-row">
                            <span>‡∏†‡∏≤‡∏©‡∏µ (7%):</span>
                            <span>‡∏ø{{ "{:.2f}".format(tax) }}</span>
                        </div>
                        <div class="summary-row total">
                            <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô:</span>
                            <span>‡∏ø{{ "{:,}".format(total|int) }}</span>
                        </div>
                        <a href="/checkout" class="btn btn-primary btn-block">
                            ‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                        </a>
                        <a href="/" class="btn btn-outline btn-block">
                            ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡∏ï‡πà‡∏≠
                        </a>
                    </div>
                </div>
            {% else %}
                <div class="empty-cart">
                    <h3>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</h3>
                    <p>‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞</p>
                    <a href="/" class="btn btn-primary">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
                </div>
            {% endif %}
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 SmartMall - All Rights Reserved</p>
        </div>
    </footer>

    <script>
        function decreaseQty(productId) {
            const input = document.getElementById(`qty-${productId}`);
            const currentQty = parseInt(input.value);
            if (currentQty > 1) {
                input.value = currentQty - 1;
                updateQty(productId, currentQty - 1);
            }
        }

        function increaseQty(productId) {
            const input = document.getElementById(`qty-${productId}`);
            const currentQty = parseInt(input.value);
            input.value = currentQty + 1;
            updateQty(productId, currentQty + 1);
        }

        function updateQty(productId, quantity) {
            fetch('/api/cart/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_id: productId,
                    quantity: parseInt(quantity)
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            });
        }

        function removeFromCart(productId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                fetch('/api/cart/remove', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        product_id: productId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    }
                });
            }
        }
    </script>
</body>
</html>
