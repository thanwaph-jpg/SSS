<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartMall - ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="SmartMall" class="navbar-logo">
                <h1>üõçÔ∏è SmartMall</h1>
                <p>‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏´‡∏ô‡∏∂‡πà‡∏á</p>
            </div>
            <div class="navbar-menu">
                <a href="/" class="nav-link">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                <a href="/cart" class="nav-link cart-link">
                    üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ <span class="cart-count">{{ cart_count }}</span>
                </a>
                {% if session.get('user_id') %}
                    <a href="/profile" class="nav-link">üë§ {{ session.get('user_name') }}</a>
                    <a href="/logout" class="nav-link">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
                {% else %}
                    <a href="/login" class="nav-link">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                    <a href="/register" class="nav-link">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Anime Banner -->
    <section class="anime-banner">
        <!-- ‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà static/images/anime_front.png ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô -->
        <img src="{{ url_for('static', filename='images/anime_front.png') }}" alt="‡∏£‡∏π‡∏õ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞">
    </section>

    <!-- Hero Carousel -->
    <section class="hero">
        <div class="hero-slider">
            <div class="slides">
                {% for product in products[:3] %}
                <div class="slide{% if loop.index0 == 0 %} active{% endif %}">
                    <img src="{{ url_for('static', filename='images/products/product_' + product.id|string + '.png') }}" alt="{{ product.name }}">
                    <div class="slide-overlay">
                        <h3>{{ product.name }}</h3>
                        <p>‡∏ø{{ '{:,.0f}'.format(product.price) }}</p>
                        <a href="/product/{{ product.id }}" class="btn btn-primary">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="hero-content container">
                <h2>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏≠‡∏ó‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡∏î‡∏µ‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h2>
                <p>‡∏ä‡πâ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡∏™‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                <a href="/?category=‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" class="btn btn-primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡πÄ‡∏•‡∏¢</a>
            </div>
            <div class="slider-controls">
                <button id="prev" class="btn">‚Äπ</button>
                <button id="next" class="btn">‚Ä∫</button>
            </div>
            <div class="slider-dots" id="dots"></div>
        </div>
    </section>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="container">
            <h2>‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
            <div class="category-buttons">
                {% for category in categories %}
                    {% if category == current_category %}
                        <a href="/?category={{ category }}" class="btn btn-primary active">{{ category }}</a>
                    {% else %}
                        <a href="/?category={{ category }}" class="btn btn-outline">{{ category }}</a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container">
        <section class="products-section">
            <h2>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
            <div class="products-grid">
                {% for product in products %}
                    <div class="product-card">
                        <div class="product-image">
                            <img src="{{ url_for('static', filename='images/products/product_' + product.id|string + '.png') }}" 
                                 alt="{{ product.name }}" loading="lazy">
                            <div class="image-overlay">
                                <button class="btn btn-add-cart" onclick="addToCart({{ product.id }}, '{{ product.name }}')">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
                            </div>
                            <span class="category-badge">{{ product.category }}</span>
                        </div>
                        <div class="product-info">
                            <h3>{{ product.name }}</h3>
                            <p class="description">{{ product.description }}</p>
                            <div class="product-footer">
                                <div>
                                    <span class="price">‡∏ø{{ "{:,}".format(product.price) }}</span>
                                </div>
                                <a href="{{ url_for('product_detail', product_id=product.id) }}" class="btn btn-outline">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 SmartMall - All Rights Reserved | ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£ 0123456789012</p>
        </div>
    </footer>

    <script>
        // Simple hero slider with dot pagination
        (function(){
            const slides = document.querySelectorAll('.hero-slider .slide');
            const prev = document.getElementById('prev');
            const next = document.getElementById('next');
            const dotsContainer = document.getElementById('dots');
            let current = 0;
            
            // Create dots
            slides.forEach((_, idx) => {
                const dot = document.createElement('button');
                dot.className = `dot${idx === 0 ? ' active' : ''}`;
                dot.onclick = () => { current = idx; show(current); resetTimer(); };
                dotsContainer.appendChild(dot);
            });
            
            function show(index){
                slides.forEach((s,i)=> s.classList.toggle('active', i===index));
                document.querySelectorAll('.dot').forEach((d,i)=> d.classList.toggle('active', i===index));
            }
            function nextSlide(){ current = (current+1)%slides.length; show(current); }
            function prevSlide(){ current = (current-1+slides.length)%slides.length; show(current); }
            let timer = setInterval(nextSlide, 4500);
            if(next) next.addEventListener('click', ()=>{ nextSlide(); resetTimer(); });
            if(prev) prev.addEventListener('click', ()=>{ prevSlide(); resetTimer(); });
            function resetTimer(){ clearInterval(timer); timer = setInterval(nextSlide, 4500); }
            // initialize
            show(0);
        })();

        function addToCart(productId, productName) {
            fetch('/api/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_id: productId,
                    quantity: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                    const cartCount = document.querySelector('.cart-count');
                    if (cartCount) {
                        cartCount.textContent = data.cart_count;
                    }
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                    showNotification(`‚úì ‡πÄ‡∏û‡∏¥‡πà‡∏° ${productName} ‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
            });
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }
    </script>
</body>
</html>
