<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô - SmartMall</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                <h1>üõçÔ∏è SmartMall</h1>
            </div>
            <div class="navbar-menu">
                <a href="/" class="nav-link">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                <a href="/cart" class="nav-link">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <section class="checkout-section">
            <h2>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>

            <div class="checkout-grid">
                <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
                <div class="checkout-form">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>
                    <form id="checkoutForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">‡∏ä‡∏∑‡πà‡∏≠ *</label>
                                <input type="text" id="firstName" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label for="lastName">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                                <input type="text" id="lastName" name="lastName" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                            <input type="email" id="email" name="email" required>
                        </div>

                        <div class="form-group">
                            <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
                            <input type="tel" id="phone" name="phone" pattern="[0-9\-\+\(\)\s]{7,}" required>
                        </div>

                        <div class="form-group">
                            <label for="address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà *</label>
                            <textarea id="address" name="address" rows="3" required></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="district">‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ *</label>
                                <input type="text" id="district" name="district" required>
                            </div>
                            <div class="form-group">
                                <label for="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î *</label>
                                <input type="text" id="province" name="province" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="zipcode">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå *</label>
                                <input type="text" id="zipcode" name="zipcode" pattern="[0-9]{5}" required>
                            </div>
                        </div>

                        <h3 style="margin-top: 30px;">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>

                        <div class="payment-methods">
                            <label class="payment-option">
                                <input type="radio" name="paymentMethod" value="credit_card" checked>
                                <span>üí≥ ‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï/‡πÄ‡∏î‡∏ö‡∏¥‡∏ï</span>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="paymentMethod" value="bank_transfer">
                                <span>üè¶ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</span>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="paymentMethod" value="e_wallet">
                                <span>üì± ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</span>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="paymentMethod" value="cash_on_delivery">
                                <span>üè† ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</span>
                            </label>
                        </div>

                        <div id="creditCardForm" class="payment-details">
                            <div class="form-group">
                                <label for="cardName">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏ö‡∏±‡∏ï‡∏£ *</label>
                                <input type="text" id="cardName" name="cardName">
                            </div>
                            <div class="form-group">
                                <label for="cardNumber">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ *</label>
                                <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expiryDate">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ *</label>
                                    <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/YY" maxlength="5">
                                </div>
                                <div class="form-group">
                                    <label for="cvv">CVV *</label>
                                    <input type="text" id="cvv" name="cvv" placeholder="123" maxlength="4">
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block" style="margin-top: 20px;">
                            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                        </button>
                    </form>
                </div>

                <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ -->
                <div class="order-summary">
                    <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>

                    <div class="summary-items">
                        {% for item in cart_items %}
                            <div class="summary-item">
                                <span>{{ item.name }} √ó {{ item.quantity }}</span>
                                <span>‡∏ø{{ "{:,}".format(item.total) }}</span>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="summary-divider"></div>

                    <div class="summary-row">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</span>
                        <span>‡∏ø{{ "{:,}".format(subtotal) }}</span>
                    </div>
                    <div class="summary-row">
                        <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</span>
                        <span>‡∏ø{{ "{:,}".format(shipping) }}</span>
                    </div>
                    <div class="summary-row">
                        <span>‡∏†‡∏≤‡∏©‡∏µ (7%):</span>
                        <span>‡∏ø{{ "{:.2f}".format(tax) }}</span>
                    </div>
                    <div class="summary-row total">
                        <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô:</span>
                        <span>‡∏ø{{ "{:,}".format(total|int) }}</span>
                    </div>

                    <p class="payment-info">üí° ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ SSL</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 SmartMall - All Rights Reserved</p>
        </div>
    </footer>

    <script>
        // ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
        document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const creditCardForm = document.getElementById('creditCardForm');
                if (this.value === 'credit_card') {
                    creditCardForm.style.display = 'block';
                    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î required
                    creditCardForm.querySelectorAll('input[type="text"]').forEach(input => {
                        input.required = true;
                    });
                } else {
                    creditCardForm.style.display = 'none';
                    // ‡∏•‡∏ö required
                    creditCardForm.querySelectorAll('input[type="text"]').forEach(input => {
                        input.required = false;
                    });
                }
            });
        });

        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        if (document.querySelector('input[name="paymentMethod"][value="credit_card"]').checked) {
            document.getElementById('creditCardForm').style.display = 'block';
        } else {
            document.getElementById('creditCardForm').style.display = 'none';
        }

        // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£
        document.getElementById('cardNumber').addEventListener('input', function() {
            let value = this.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = '';
            for (let i = 0; i < value.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formattedValue += ' ';
                }
                formattedValue += value[i];
            }
            this.value = formattedValue;
        });

        // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
        document.getElementById('expiryDate').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            this.value = value;
        });

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        document.getElementById('checkoutForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                district: document.getElementById('district').value,
                province: document.getElementById('province').value,
                zipcode: document.getElementById('zipcode').value,
                paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').value
            };

            fetch('/api/order/place', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = `/success/${data.order_id}`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
            });
        });
    </script>
</body>
</html>
